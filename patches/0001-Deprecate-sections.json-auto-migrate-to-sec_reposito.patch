From e33036e3e199b3dbd4f76e3c4c1ee0d13b699f72 Mon Sep 17 00:00:00 2001
From: "dan.carloni" <d.carloni@studiocallari.com>
Date: Fri, 6 Feb 2026 00:34:31 +0100
Subject: [PATCH] Deprecate sections.json: auto-migrate to
 sec_repository/sec_repository.jsons; preserve tmp extension; add .jsons
 support in GUI; update demos/docs; add migration tests

---
 core/__pycache__/__init__.cpython-312.pyc     | Bin 798 -> 794 bytes
 core/__pycache__/geometry.cpython-312.pyc     | Bin 14497 -> 14484 bytes
 .../__pycache__/interpolation.cpython-312.pyc | Bin 1641 -> 1630 bytes
 core/__pycache__/materials.cpython-312.pyc    | Bin 961 -> 957 bytes
 .../__pycache__/reinforcement.cpython-312.pyc | Bin 1423 -> 1419 bytes
 .../section_properties.cpython-312.pyc        | Bin 1264 -> 1260 bytes
 core_models/materials.py                      |  17 ++++
 docs/IMPLEMENTAZIONE_PERSISTENZA.md           |   2 +
 docs/PERSISTENZA_SUMMARY.md                   |   4 +-
 examples/demo_backup_system.py                |   8 +-
 examples/demo_export_backup.py                |  17 ++--
 examples/demo_export_gui.py                   |   6 +-
 examples/demo_persistenza.py                  |   2 +-
 .../demo_verification_table_auto_update.py    |   2 +-
 pytest.ini                                    |   3 +
 .../__pycache__/sections.cpython-312.pyc      | Bin 56979 -> 58466 bytes
 sections_app/models/sections.py               |  42 ++++++++-
 sections_app/services/calculations.py         |  22 ++++-
 sections_app/services/repository.py           |  78 +++++++++++++---
 sections_app/ui/main_window.py                |  19 +---
 sections_app/ui/module_selector.py            |   4 +-
 tests/test_drawing_geometry.py                |  52 +++++++++++
 tests/test_main_window_save.py                |  54 +++++++++++
 tests/test_materials_frc.py                   |  81 +++++++++++++++++
 tests/test_migration_sections_json.py         |  84 ++++++++++++++++++
 tests/test_repository_save.py                 |  26 ++++++
 tests/test_sections_properties.py             |  58 ++++++++++++
 27 files changed, 531 insertions(+), 50 deletions(-)
 create mode 100644 pytest.ini
 create mode 100644 tests/test_drawing_geometry.py
 create mode 100644 tests/test_main_window_save.py
 create mode 100644 tests/test_materials_frc.py
 create mode 100644 tests/test_migration_sections_json.py
 create mode 100644 tests/test_repository_save.py
 create mode 100644 tests/test_sections_properties.py

diff --git a/core/__pycache__/__init__.cpython-312.pyc b/core/__pycache__/__init__.cpython-312.pyc
index 8c9cbe929fdc4baa48a28d90d96dc25202a1406a..a88960527fc3db65db80e13b657c34d29b25a980 100644
GIT binary patch
delta 74
zcmbQoHj9n#G%qg~0}y1)ZO&w5-pDtFNl(YwDyBTYD7&~IF*&t3CdkFe$jA~#CFd8V
W#>B^G=4F<|$LkeT-kN-c$qN7&gBQ2}

delta 78
zcmbQmHjj<(G%qg~0}w=hZ^?YXw2^NLlaYabMt*Lpeo<*&UTTqkd45s0evpfik&z{g
aO3p7z)sK(Q%*!l^kJl@x{5AOklNSK9<Qd8U

diff --git a/core/__pycache__/geometry.cpython-312.pyc b/core/__pycache__/geometry.cpython-312.pyc
index 61ae52d1d8d2fc5adeaf7d4456343ff6d205fd65..b02146704c70e448e8d247b9c8d7bae0fa0c882b 100644
GIT binary patch
delta 169
zcmZ2jIHi#9G%qg~0}y1)ZO)u5zmcz+SxLv)DyBTYD7&~IF*&t3CdkFe$jA~#CFd8V
z#%x~CyiJJl*5ouXODS=n<`)b<8W=7J883`oz&OEhy4ggt=@tuPC+`r8WLpw@S;+YE
zWF0|;&F12J85z4Kf0eLczAY#=*;LY+nL$W=bFri&6XW*DTctI@!q21|z`~g_E2J22
KZ5A@`X9NIuH#ctp

delta 175
zcmbPIxUi7#G%qg~0}w=hZ^^8Y+sIeVtY)B}k)NBYUsRfxms+G>o?n!$ALL?WWMm1W
zlJkpF^*66(-X_HOYjTp9rKA|pfENru8W=7K882X*U^v}uqS<tdi$cbew~9qFFOI#k
zSy21|BV+&MPZAa!Hw48#F)(u~OxBgOW(Lxmvn3sw823zGE3FBUW8*ZQd{erC8AxxA
Pky#<d_-iw(c|Rina$+~?

diff --git a/core/__pycache__/interpolation.cpython-312.pyc b/core/__pycache__/interpolation.cpython-312.pyc
index 54c8410eb2e11eb406e1ec2f4481c2bfe60f7b45..ce3b50a0ad859b7a6c8eb3c5bb68bf1b1bd10764 100644
GIT binary patch
delta 113
zcmaFKbB~AjG%qg~0}y1)ZO-i7$ZN`|Waw-aQ=VUxU0jfuoLU?c<YHuGWC^2^^NUhr
zHfJ!ZF)`kn+|O*q!vWOWz_5aGh2kof$=8{mGH#r_m!**Tnw;@uGgf_O26>ao8La1l
IiY?d-0k8@p!vFvP

delta 124
zcmcb|^OA@6G%qg~0}w=hZ^<m&$ZN`|W~!f&pPQ;*RGOEUTBKi|UzDvM<YHuGWC^2^
z^NUjTH>WVFF){v{+|6vo2Qr|6VFlv~#g!}#43jT1KV{rDc{@uX$7MO=PYg_~mXozv
Q^_f9*EbDoo9$hv=05*vwa{vGU

diff --git a/core/__pycache__/materials.cpython-312.pyc b/core/__pycache__/materials.cpython-312.pyc
index af287d71c85c27ebc420ed76b3d0f7f11955d769..8f58429014281a2d2679a8bee9012def34319162 100644
GIT binary patch
delta 68
zcmX@ezL%Z%G%qg~0}y1)ZO(Mv$UBWuN!QsbraZqWySN}RIkh+@$i>LW$Pz{+=NF~M
QY(B|Y#K?GSvJG=90KecBg8%>k

delta 72
zcmdnXevqB_G%qg~0}w=hZ^<;=$UBWu%}_rhKQ~pss5CDxwMf4_zbIQj$i>LW$Pz{+
U=NF~wZ$8Rc#K`z-vITQ103Ib4p8x;=

diff --git a/core/__pycache__/reinforcement.cpython-312.pyc b/core/__pycache__/reinforcement.cpython-312.pyc
index 31825c88a6d94b1fa38ad9d2b0f1040c4895d355..99844b2bfb782f578330a4d467bfb9a7727a31df 100644
GIT binary patch
delta 68
zcmeC@?&jt_&CAQh00bFxn=>bE<o&>?Waw-aQ=VUxU0jfuoLU?c<YHuGWC^2^^NUhr
QHY+ndXJWiHnVYo*0L5Dsa{vGU

delta 72
zcmeC??&sz`&CAQh00fcWTQbWw@_t}cGu6+?&rQ`YD$UDFEz&Q~FUr;raxpS8vV>8|
U`9-Pvo8_6FGco>}%+A^Z03#$8hX4Qo

diff --git a/core/__pycache__/section_properties.cpython-312.pyc b/core/__pycache__/section_properties.cpython-312.pyc
index 19babef96680ca4ed59fbca2381fbe9cec565d6c..120ebca56ce68a68adcd059d1dbd25b7d548da10 100644
GIT binary patch
delta 68
zcmeys`G%ACG%qg~0}y1)ZO&Y_k#{?zl9{trOnH7$c5y*sa%yo*kc*L#ktK{u&M!)h
Q+5C!e2NUD1$%|Qh0r?si2mk;8

delta 72
zcmaFE`GJ%7G%qg~0}w=hZ^>-k$h)0U%}PHbKQ~pss5CDxwMf4_zbIQj$i>LW$Pz{+
U=NF~wZ+^zOgNgCi<oPVV09Z&E7XSbN

diff --git a/core_models/materials.py b/core_models/materials.py
index fc4b935..aaadb2c 100644
--- a/core_models/materials.py
+++ b/core_models/materials.py
@@ -25,6 +25,12 @@ class Material:
     type: str  # e.g., 'concrete', 'steel'
     code: str = ""  # ‚úÖ NUOVO: codice del materiale (es. "C100", "A500") - permette ricerca per codice
     properties: Dict[str, float] = field(default_factory=dict)
+    # FRC (Fiber Reinforced Composite) optional parameters
+    frc_enabled: bool = False
+    frc_fFts: Optional[float] = None  # tensile strength (design) of fibers
+    frc_fFtu: Optional[float] = None  # ultimate tensile strength of fibers
+    frc_eps_fu: Optional[float] = None  # ultimate strain of fibers
+    frc_note: Optional[str] = None  # free-text note or source
     id: str = field(default_factory=lambda: str(uuid4()))
     
     def to_dict(self) -> Dict:
@@ -35,6 +41,12 @@ class Material:
             "type": self.type,
             "code": self.code,  # ‚úÖ Persisti codice nel JSON
             "properties": self.properties,
+            # FRC fields (optional)
+            "frc_enabled": self.frc_enabled,
+            "frc_fFts": self.frc_fFts,
+            "frc_fFtu": self.frc_fFtu,
+            "frc_eps_fu": self.frc_eps_fu,
+            "frc_note": self.frc_note,
         }
     
     @staticmethod
@@ -46,6 +58,11 @@ class Material:
             type=data.get("type", ""),
             code=data.get("code", ""),  # ‚úÖ Carica codice da JSON
             properties=data.get("properties", {}),
+            frc_enabled=data.get("frc_enabled", False),
+            frc_fFts=data.get("frc_fFts"),
+            frc_fFtu=data.get("frc_fFtu"),
+            frc_eps_fu=data.get("frc_eps_fu"),
+            frc_note=data.get("frc_note"),
         )
 
 
diff --git a/docs/IMPLEMENTAZIONE_PERSISTENZA.md b/docs/IMPLEMENTAZIONE_PERSISTENZA.md
index 1e6aad5..20562ab 100644
--- a/docs/IMPLEMENTAZIONE_PERSISTENZA.md
+++ b/docs/IMPLEMENTAZIONE_PERSISTENZA.md
@@ -95,6 +95,8 @@ repo = SectionRepository()  # Usa default "sections.json"
 repo = SectionRepository(json_file="/path/to/custom.json")
 ```
 
+> Nota: il file legacy `sections.json` √® deprecato. Il nuovo percorso canonico √® `sec_repository/sec_repository.jsons`. Se viene trovato `sections.json` in posizioni legacy (es. cartella di lavoro) verr√† migrato automaticamente nel file canonico con creazione di un backup `sections.json.bak`. Per disabilitare la migrazione automatica impostare `RD2229_NO_AUTO_MIGRATE=1`.
+
 ### Repository usati nel progetto:
 - ‚úÖ `tests/test_verification_table.py` - Line 28
 - ‚úÖ `test_section_manager_ui.py` - Line 24
diff --git a/docs/PERSISTENZA_SUMMARY.md b/docs/PERSISTENZA_SUMMARY.md
index 2450573..631b858 100644
--- a/docs/PERSISTENZA_SUMMARY.md
+++ b/docs/PERSISTENZA_SUMMARY.md
@@ -79,11 +79,11 @@ repo = SectionRepository(json_file="data/sections.json")
 ## üß™ Esecuzione Demo
 
 ```bash
-# Demo pratico (crea demo_sections.json)
+# Demo pratico (crea demo_sections.jsons)
 python demo_persistenza.py
 
 # Analizza file JSON salvato
-python analyze_sections_json.py demo_sections.json
+python analyze_sections_json.py demo_sections.jsons
 
 # Esegui test
 python test_persistence.py
diff --git a/examples/demo_backup_system.py b/examples/demo_backup_system.py
index 7d2b20e..92dc2ec 100644
--- a/examples/demo_backup_system.py
+++ b/examples/demo_backup_system.py
@@ -40,13 +40,13 @@ def demo_section_backup():
     
     # Crea directory temporanea
     temp_dir = tempfile.mkdtemp()
-    sections_file = os.path.join(temp_dir, "demo_sections.json")
+    sections_file = os.path.join(temp_dir, "demo_sections.jsons")
     
     print(f"\nüìÅ Directory temporanea: {temp_dir}")
-    print(f"üìÑ File principale: demo_sections.json")
-    print(f"üíæ File backup: demo_sections_backup.json")
+    print(f"üìÑ File principale: demo_sections.jsons")
+    print(f"üíæ File backup: demo_sections_backup.jsons")
     
-    # Crea repository
+    # Crea repository (canonical .jsons)
     repo = SectionRepository(json_file=sections_file)
     
     # FASE 1: Prima aggiunta
diff --git a/examples/demo_export_backup.py b/examples/demo_export_backup.py
index e9b7bae..dd60908 100644
--- a/examples/demo_export_backup.py
+++ b/examples/demo_export_backup.py
@@ -33,7 +33,10 @@ def main():
     # Crea repository temporaneo
     with tempfile.TemporaryDirectory() as tmpdir:
         temp_path = Path(tmpdir)
-        repo = SectionRepository(json_file=str(temp_path / "sections.json"))
+        # Use canonical .jsons path for sections
+        sec_dir = temp_path / "sec_repository"
+        sec_dir.mkdir(exist_ok=True)
+        repo = SectionRepository(json_file=str(sec_dir / "sec_repository.jsons"))
         
         # Scenario 1: Popola repository con sezioni
         print_section("Scenario 1: Creazione Repository con Sezioni di Test")
@@ -63,8 +66,8 @@ def main():
         print(f"  - {rect.name} (RECTANGULAR)")
         print(f"  - {circ.name} (CIRCULAR)")
         print(f"  - {tsec.name} (T_SECTION)")
-        print(f"\n‚úì File principale: {temp_path / 'sections.json'}")
-        print(f"‚úì File backup automatico: {temp_path / 'sections_backup.json'}")
+        print(f"\n‚úì File principale: {sec_dir / 'sec_repository.jsons'}")
+        print(f"‚úì File backup automatico: {sec_dir / 'sec_repository_backup.jsons'}")
         
         # Scenario 2: Export in JSON
         print_section("Scenario 2: Export in Formato JSON")
@@ -100,16 +103,16 @@ def main():
         print(f"  Colonne: {list(rows[0].keys())[:5]}... (prime 5)")
         
         # Scenario 4: Export senza estensione (default .json)
-        print_section("Scenario 4: Export Senza Estensione (Default .json)")
+        # Scenario 4: Export Senza Estensione (Default .jsons)
         
         no_ext_export = temp_path / "export_senza_estensione"
         repo.export_backup(no_ext_export)
         
-        # Il file verr√† salvato con .json aggiunto automaticamente
-        actual_file = temp_path / "export_senza_estensione.json"
+        # Il file verr√† salvato con .jsons aggiunto automaticamente
+        actual_file = temp_path / "export_senza_estensione.jsons"
         print(f"\n‚úì File richiesto: {no_ext_export}")
         print(f"‚úì File creato: {actual_file}")
-        print(f"  (Estensione .json aggiunta automaticamente)")
+        print(f"  (Estensione .jsons aggiunta automaticamente)")
         
         # Scenario 5: Export in directory nidificata
         print_section("Scenario 5: Export in Directory Nidificata")
diff --git a/examples/demo_export_gui.py b/examples/demo_export_gui.py
index 9bbad6c..588fa54 100644
--- a/examples/demo_export_gui.py
+++ b/examples/demo_export_gui.py
@@ -35,8 +35,10 @@ def main():
     temp_dir = tempfile.mkdtemp()
     temp_path = Path(temp_dir)
     
-    # Repository sezioni con dati di esempio
-    section_repo = SectionRepository(json_file=str(temp_path / "sections.json"))
+    # Repository sezioni con dati di esempio (canonical .jsons in temp)
+    sec_dir = temp_path / "sec_repository"
+    sec_dir.mkdir(exist_ok=True)
+    section_repo = SectionRepository(json_file=str(sec_dir / "sec_repository.jsons"))
     
     rect = RectangularSection(name="Pilastro 30x50", width=300, height=500)
     circ = CircularSection(name="Palo Circolare D40", diameter=400)
diff --git a/examples/demo_persistenza.py b/examples/demo_persistenza.py
index 92922e9..e115d5f 100644
--- a/examples/demo_persistenza.py
+++ b/examples/demo_persistenza.py
@@ -22,7 +22,7 @@ def main():
     print("=" * 70)
     
     # Usa un file JSON personalizzato per la demo
-    json_file = "demo_sections.json"
+    json_file = "demo_sections.jsons"
     
     # FASE 1: Primo avvio - crea sezioni
     print("\n[FASE 1] Primo avvio - Creazione sezioni")
diff --git a/examples/demo_verification_table_auto_update.py b/examples/demo_verification_table_auto_update.py
index 1f8bd99..89ecc11 100644
--- a/examples/demo_verification_table_auto_update.py
+++ b/examples/demo_verification_table_auto_update.py
@@ -26,7 +26,7 @@ class DemoControlPanel(tk.Tk):
         
         # Create temp repositories
         self.temp_dir = tempfile.mkdtemp()
-        self.sections_file = os.path.join(self.temp_dir, "demo_sections.json")
+        self.sections_file = os.path.join(self.temp_dir, "demo_sections.jsons")
         self.materials_file = os.path.join(self.temp_dir, "demo_materials.json")
         
         self.section_repo = SectionRepository(json_file=self.sections_file)
diff --git a/pytest.ini b/pytest.ini
new file mode 100644
index 0000000..9a590ae
--- /dev/null
+++ b/pytest.ini
@@ -0,0 +1,3 @@
+[pytest]
+markers =
+    ui: mark tests as UI tests requiring tkinter
diff --git a/sections_app/models/__pycache__/sections.cpython-312.pyc b/sections_app/models/__pycache__/sections.cpython-312.pyc
index e0e98afa0b3ed4c16b2a52cb75d581bbc2721562..32346842f242bc5aefd4dc795ca4ed08592fc491 100644
GIT binary patch
delta 13294
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

delta 11826
zcmbta3wV=Nn$DkF)22;Znl??ZY1%?l+R|bxP%H%s0%K_{SEs0<G(T-Hy>OC>bjq|c
z9q)s}aS#x+j-yh+%S>>*JG$$xKI>&fSqI~YjQgnTvpX8ZecV}{nf>1Lr%9Ryg_$UC
zzyDmmbNSxyJKy<}k6zXA=QXC+Qc{vs^yxnI6L-xgyG_~B!QC@18kSTpl}qbM>`7`*
z>M^z(dy?CeMVZc%(qn2j30dz+ZBM0k37)i`^!9W~rB=zQTS}mA@<+}%A}J;9<}Q`X
z@C&Iu)0OB-av2GeL;s~5G_+??t%+(2EwV<fTBdTPj;dT~N7PE^BO$Hr*?Xk?bZe+d
z1~oCu)+3tTK}%vLJ!Ij5n<Ptug`ToyE3c5O309JGNNy%Mm*hN>JtXIoTtM<|Bo~rw
zBl#%FMI_rvex2lEl1oVbZ<0$%o=$SI+L|zf<T8>g)YfGVlFKo2%v?+59649clk;Vp
zTqN7&V!1#rluP7N*UW>-?bBUVu8L7@`wZ7CS0()|<FBhLGc*BpzdNAyZe_ke0_$+O
zJ9>GhrZhtem{^~$!zVl4y)yH;I~;c2tqJno+Dpr7Xk3T-Q<nG2*1T8FG_u*svof1t
zBfCgEvy1rOv^x{i>48ln;3K+9es5Bi`b!o6o$gERcD2LoHzt@RDWBU6HF^gcmUCyB
zh3_}yOPTyhLserw6$VnB&W_$*%*Nf<>vcL=BbqJ*ECMVBGy#?XmIA`svh|nZc^Ti3
zxIDE1B47>u^B&>9PTbE&lCtzIqTGKlDNnMeLQW$HsMsv}^C|rkpMY+&r?11u^7xr9
z^PbZ>e%3fUa}`ywWWY**P}IunlM6Ek>DddykEo6|9n<*}jyAIv-kWSmFi~L(TflEi
z-lVS9@L+O{q~jyc=a`37&X7%2Dx#}2s@)-RX=&E99qJ+VNQKWp9mQvhk#}60A*uOG
ztFw50YAJu2XQ;1F<u7pyzcn>Ul0?PP)bx~ui7rE`EoppXszplUMLlMITWVssRbq|S
zO3i5W@Brj6IvSlkV@NZk8d6XA#g*hAJG47=G*T81+7m4LA?=`!`l_9YlSVpaw-)M$
zbfG%o_o$z;gan$YmCw2{Ln|hDW>rRlc1Sm*-ZG7oOe?gR%vnc5^OC0aH;DclFU{a@
zr5N~FdXCy*^y{Zxs^+8SW~rJVHy0<vm|jE$8*AN@xlG#6muD7AExbFkI)TCAKa+U%
z17`oDnNDf-TzY2n0QG?R1c9W>S2$NMZCbOUwS|E>EDK-(pu0n-@Fk(U!`tEWF}9Wp
z0|{L+F_xb4`9{knQY$}XSs^{lKeare&}|Jrls&Qnb7LS;K+j~~0P79td;|R+*`a4$
zsA>ar0|a+_AoUVBi~)nQv#+Orz$ddSser#|wXfBC`ntMg7SOrmO#@wGR;(ReHUJby
zKxaL9yzJS`I#4XMdmwEATtnd16WGLuwepoY7v+tjw2wA%L>0_a<rdysxxe!6SvP5K
zOAYG%>vOM^)I{!GbF6+%ez{a8L(ygehlcs+Pe8gRpmn)>yk78|^s-j8=;vz-Y|@+j
z+JYOT_53dd`3ul^!c=I{M=+SSTJD7FS4}MVJt{p5PK>DjU@CgcP$c}WQ_I`h%zjUy
zRy{2boza4&5Rid<d}q;IGQzV(P0}Cu--=e0z*RfJiir;hOw*IjK1Fz!%B>>jYki=C
z_id@*zr8Mt-*ZEjKWP6Kbw;5}I}v+(C6|^<E*t-4X<c#A<Z`$4fHZL!Nva`fwaQ`l
zzc@Wf8eUB!(VP$mSUB7;F=s>^ww0iTA@;EXfG}Jkq-6jbK$x`%lCZ5El8B4NkQM?;
z0E+;nfW?661U4mD&cO2$Kp9|i*tD#1BnI>Y{VqBJ&OK3>nDqldL5Ef`ww5||u<a-Y
zx4c>caEYj7apdd&gt8y-ddCe?27k$sm7S4dI-QpJ^uV3l_6>~nKJGeUng41@P?y2K
zaAem|Wze8X&p9|}toAL(yr*j4$z2#sL}^lNsS%~gysbP#osz*<mS^XnAWfB?`KzUO
zcI}hL)*P-qkyZVaFPNUehs(2vQEgVGXZ=bRL(7NPoUqJ((HzV~MOK`C7F1-%sj#9V
zCr(8!D)Qn~<Y%M|n}P+ZbnDYg56&1XJ)He`?TMVZFZzOo=wgdgQG^P+Dn0L|(u3>A
z)*im>Df5Z^1+T6N7NeqMYQ>pSs`yHinV1x;P^Fn~GAe$8n1v7j&zZL3^(3$#5sa&a
z_1KLhd(kB1r2z``%~^a=h0T~x?!tbI4lUeMaYqq?SHR>X$Ci7&<e<)L<n3$+`opha
z@BGSA$;O*1OGV7<l=vTK&d3c9IjJqw{)|6fnOjg28HNgJULxut{y9kIpH<omN6;E!
zmR%o~c7~-MUS4Id#6tehw8Y)%+u-%F3LC*yLRCQ9($_0b=rvL^hnY*AIWFOR!VPuM
zCHylIK0$Fd01%8vXkw#)n*g^0b^(3{SP4LgQ6ilP;{y2CRnD5_lCJRV8g-)1d^Stc
z+0W`zb<3r*_9}YbD2W2KuKp_nNs5j(N;#~2Y}T$car}sdr$hNPzM$G|sU>k-8x=~F
zh42@uEz^}|)WDIT*f$mZ!lfd`p_JyE>Rf#*Y7THyot1x3pCHZR4K+1%Os37x@!wpt
zPhE$x$4yFHx{wsi;-S+lJYpbeU595tUdmV>Q}!<b;|lXmQ>G{)Uu1+4)C)Tc6EDK!
zVn7o>M6j6P#e=ok%5wT>IX0=*KdY`)qO}ZPJX#r^2^~&1Kts5I-9nGi+-JA)>N!=?
zmE1{)^X+C^q;WLSp$2vzEaF8qW`5b+6v@edIJaUgC_qd@#22Z9BS|rn$Qy+&VN4{*
z3ZI4PM6DpAsJ#QVy8(9+IFgC1nJuDoGYUoL1CaUvf{B<+AjRqI^mKT=owCQ{bdF2x
zZYmYNxlp0yUbF|4@rHTxl)PlG;M&jUjTj?b%iy;94b63Ey^nx4Za-u(W(ErMQQSg7
zh*prqn0k_M1lUHDfe-Lk>hmQx|G2(fYVoJdzegHAL`^=!QK6(*V<eGUq3k}CLPacJ
zGQ_ZyI?=^tz#GfV5%f4;-bl*TqpH(dBK!bbIhft#W}O3`4i=k%^zfYx-v~Zg`CSWs
zP$s5%KXsu9B{(Gt;?OCvai+AF*ENO%;+YT4+}BuVe?aN{5auj8PoWoot+AML*Do3i
zmx#b}7(EP8bQ0YJVa|g@Mv$mMbP*(q!yh(|$vjLD&6%Sp1a$IWF04{Gb5w9<<o3t-
z*rJ&^5#E^5HWQ#^%)Gg6beM@08$24<NAW1OE$S1aXcebEmSxD`1k0j`Mn!|^Yr^((
zy7j$opVRpu|9tThGT`X$RrxrN$VbIIMN%KV_52r2Wzui>YfUz4oi^X<*DWd5t_4}y
zJ%D=wV#Q-5QChC)ard%#lNBr$2L=Kjwd=T!J%ip2=$J<->W<~PdHE<o><bvSJ2!he
zdb{L+Zo6}vyooL3$CejMBmCs@;-%+H>vCvP%h%Dr?QAA=R{$yjRea%!(y|EKqqZq@
zvv@`#+h0Y=043VIZEuzT*%g&)+K1`~9$7W6X<>r#+IXuS*C~DwZzHC<1<hu#a1CEL
zr$Bv1;)a!NG{#l?U%wbmL7Ie9#M2aQD6B|?U<+?MU{QY~@j2I5@%JAx@<&^&)59J^
z2UseaiV!Pw3Xc)SU(2PP8Fk`0jt5O745EH=NFGmvH*FB=gf|Iwky|31D`4nnef{(<
zWxHbaKFlH<tK<9HF|+|3;t#YwqWIb|#n<k>ho`m`Pt6D3U$l$A)s{Rg;&ilsMGmfP
zXtfeJqWvpQ{dxOWbCiDx_e$X#RxJ)W%#*83+L>?|N>Rdt1Ps?XJLO)wT!80_6mlaT
zTvtAfD;^5~o(F{cvGC;CWPf5Wpj`ujBTI=IVHE*=xAR)s_<%w7$ds!3LMMeCJ;Zfs
z1X8q1&8Fvbrx<Ac3gA^h$gB43Etp6-zF40n<@@zloI=V$zS11!E0L9iIYL*#m^>u1
z$f>@<Pqmlm+sP-rOL_f+4qmeXk%_#eMjRm_Z;1>O(KW?ec<YsU(kAY?vUO9~KOE8i
zA+!j-iyT8pLZ6U8q4Q2!Oz@Cqp-^~;P#Brpc^^L~FepIFe|*(G#U)M%m#Dk?@hEr5
zLAzX}$LlYKxQ~D?sQV#{!ITCljZTcirLo*c%vR2pa0;`sGtWS;M{%4m{+_cg#P_m|
z<!b2=U%hGGoX0TQ8o(F<4HQu?*n5tghX3=XqGkE$_V*^i=&SIO&+N>b;N{BBV(G{J
zt(~isRCuUf3E*la;Xt^WNQoo!oJv4yHdw(QyE>EKE?cBW`9t!>wDME(bu$D3HA=XS
zXqZa79h)7}G5*lzs+I`tqVr<WS5Pb$3lUPBfXpTbVI?nKEIJE{iOvV0;e2B4$7l$+
zh7WdaRfzR55$p4)d?w;m(A}AU7fyV^!&h~(Ip__J(Qy^w*yQ%(hNyIAa#bwb45Ue6
zTO?zC!#!Pkk$>f$PZ@LdmVeR^$IkXN49Ckt46#vDY(-4K6tPmdaRs#7h{yqLH{k_l
z(IN;e#p)dZ<Qo&r`%`V`PT9xba2FavImMg)w7z#iz;B=Ci^G9Y6BXh?L^>;CVxm~W
zR5tSGw$|$ZLgDc2914e}JeMi2^XXj!jPva?H&=j`q)%iKG21?cn|r(!l9pF`8?Ojc
zb38dJV-WoXAtMn{%<Mc#I-Y_!xJ;;t#6h9qyqWqr_89OKxA{gDrhXpIz}dj8D8`!6
zHWMH++bksmpN9g$*60i&wk<U}M+UCwf)e4D;--2xJ$lcXfv<?l5E4Yl%+&BN7T5AW
zUz<u?NZhs|_Ym|w4T!bMGkkbkj#SDIY%3-1zqsvjjdYT4{n0FOXJqfAOC-pquu~{_
z4-f!64~VliC4qPbwc)H>BoO0M5{LvJef#8bcC*uHoex0ru;Luq165ym@=)9gwTM)M
z>5<(EIgLX@oBLOZZ@i_!|H;tHp}Zn~4jwkn)Eqoq73WO{1}<EI99*}BMmx(*`^)*)
z!zE-LN-pLICz_IqM-;}|Oi9I8@H;kVNsM27{pzlWLq(?;!Z5;l1WSb^v<gY2&_WVK
zTZJu(ycc;3kCP7pB@<sKv_>-V$TWqMy^Vgt@YwF}OTtwWwE-ma4Ld_gxQd&868s)F
zTg+V04mV?J=+F?H(?h0R?v8R1;US~&5DWjG(F(EwT~w79r|0mH+kcvCyp!z4p2c{|
zRrSrE{uZ9H>*m>49YSf0r<ndBPYLJSOwa%J^TL7%eWRBW;_p6x`z@);&GFIVL~KS9
zU}`w0X%5;hcY}t;lUR-s?F0pLK|z*+=P6|4m+i`LK8^PDdx6l4SG*r#sd$XT6PAXG
zhp9>QyNzim1pJ5}+Z8hPG&1$8eAXR~xaJlFwIHfGlrId0xqpM9pM>&w0g)H(E>M4|
z;f=dPZy>(YuxEDLjcP6Fi!$t-Jr}{SuRmGQy~f7+u9dx=?hf|%*jSlArh6YCCK|@r
zcp{H1+-)(146CP^dH)rGDbFwOeMAXNkLLXwl)VO+YGVGuz6z<4C+%OQgcilFZ=ms1
zyDm9UvT_+#|0e3gA%y)7kMZn!92K#4wZg7|&oumr14or3(@KW5@{zk=h%#&>JrL0-
zbX?AdP8gP6NbZL$qDX98)W^S2E4t88M6vTYE}Noaf%3xYhrHuZ6Kxn?LA`M3zcl)j
zq;If{AAfR&rimTm@7;IFaEyP)KMCVZ`vR`gx^D3*>NFOU55PGXItIm=cRikW0u})-
z{2a`W1d{Z~HiYQr_NU)p5Q-zSKcWGq-kl?x9fx{p50*$rc-@1SN1bY<A|^GAsF*@X
z8gkImBu+IyAA6|n0xr%%>soBecb{sL4>X6kIJXI_MH0ry3<VYYp!Iv+CE4HufXm^s
zyLsAk1^oAiw<*406TZ+het%qF$R+jR%Z_`V2ysCSd4|9n=dMD<gX!y{I4sVym-*?3
z>q8W-J#t2^q;KN>@))#*b2z#vJ&%G2RWSpFrMQPH`C0=><7VX>fTZpY&t~T~x69WZ
z(0k<GE?@We-(%`7n4Yv+Gq3K<DzqtIV_@H-7aC&e+kVqy2b3$$o%XLW;r|6p<s-Tm
zuESxMrqfZ2Kcg9fT;%prBu>3=P!XSu>p;e3$>{#=M0Y06zQ5pcGMm_6Q5G8>XMh@j
z=lJ1Yhb|N|LX5bTzw3`a`X<{X%!;e|t;fvv?`H;o=~#g=50m{;OcwF%e$5k_l0$fm
z!v!`IldB+5w%#zY^`yx%ai=WzyPmo$wBdQ*wc-5eGZkr9oMWq%gDC!1^RZ`3mO1~C
zO`eT)0L<L@+^F&u4jvuJtQKpp1Iz`y3z!FR0qOzs0T%=2031+O>wo9Dy&1!4C|C_h
z1<V47BSsBL=nfl=Vx4FdE{JL_CV(%5=rx&WB)%Mqs1tJ&iFG9USX8Rnc&{bePpyld
zjaXGSreyW!95+eBF%wa$P#+l*n=n;74H}A}k(QHpYNAhMnUN_^^jRO;&m3q&e3{sr
za6!~Wu<3O8$4nW$q8cei;eUPmLuoZX^^R@MM%1q*2qZ4Ou2b&EkC+%kp_jm+325jC
z69MU3<u@0Uz0x}$db`MHooJLU=Y1zU!!|T70u%rW0r>zE0e#mvA3VUV$dS!9(w~5i
ze&yiq59kK^>8l21>@+9+I%9yz&i+2H+vlb?;d`m2_zF*aw;*N|NZ8iFdfmNU;@zsa
z?ocA!N$o`LBo2>{(d~192pEFU_u;V}umMny`G~n$#iEp-powjp*!SqL-bH=rccE7P
z?!OmjMhFnGKm#|uyIiE5fo#6$M7Ex-pb@tD2j6`^aVExgr~|rd@q2=R&eO3;_DuTr
zej#Q9@bQt;<(D9^61Q)}ME3xC0BtDMv&+yHwqnhYu%}8rN4<l8a=KwSp!aR>#~vZ8
zXGs7fK|nh&;C6{$fd&%r3p_MAh1wL<CejZ9o5k<)*m4wt00Cpu>UGZLOBXF!x@t9Z
zqIesi0e~6B+UNw8m5SGsiUm}d<TOCUK8jWN@jqIIu}fm*F+W5J7%u7Qa}9Xp1#BHP
zq5oChB@`!u8cC8qP}x6Km3^qPA6MBwRFxf9m3^Sf`VW=qV^zcH#GIQfzfa6Lo|v<5
z?mLMkBl<73#i{BMWAF+|WiCINR(8@-bTX&<WO^?C=UpG=*5pWzpo-wEMx{0e)p)EY
c>1#FJhV4PziS3~(QLshlKlahXk``9_e;f1qIRF3v

diff --git a/sections_app/models/sections.py b/sections_app/models/sections.py
index 0c4c229..12ec84a 100644
--- a/sections_app/models/sections.py
+++ b/sections_app/models/sections.py
@@ -1,13 +1,13 @@
 from __future__ import annotations
 
 from dataclasses import dataclass, field
-from math import pi, sqrt, radians
+from math import pi, sqrt, radians, degrees
 from typing import Dict, Optional, Tuple
 from uuid import uuid4
 
 import logging
 
-from sections_app.services.calculations import rotate_inertia
+from sections_app.services.calculations import rotate_inertia, compute_principal_inertia
 
 logger = logging.getLogger(__name__)
 
@@ -37,6 +37,11 @@ CSV_HEADERS = [
     "Ix",
     "Iy",
     "Ixy",
+    "I1",
+    "I2",
+    "principal_angle_deg",
+    "principal_rx",
+    "principal_ry",
     "Qx",
     "Qy",
     "rx",
@@ -105,6 +110,13 @@ class SectionProperties:
     ellipse_a: Optional[float] = None
     ellipse_b: Optional[float] = None
 
+    # Principal inertia results
+    principal_ix: Optional[float] = None
+    principal_iy: Optional[float] = None
+    principal_angle_deg: Optional[float] = None
+    principal_rx: Optional[float] = None
+    principal_ry: Optional[float] = None
+
     # Timoshenko effective shear areas (A_y, A_z) in cm¬≤
     # These are computed as A_y = kappa_y * A_ref_y and A_z = kappa_z * A_ref_z
     shear_area_y: Optional[float] = None
@@ -145,6 +157,27 @@ class Section:
         # Calcola le propriet√† geometriche specifiche di ogni sottoclasse
         self.properties = self._compute()
 
+        # Calcola principali inerzie (I1, I2, angolo) se possibile
+        props = self.properties
+        if props is not None:
+            try:
+                if props.ix is not None and props.iy is not None and props.ixy is not None:
+                    I1, I2, angle_rad = compute_principal_inertia(props.ix, props.iy, props.ixy)
+                    props.principal_ix = I1
+                    props.principal_iy = I2
+                    props.principal_angle_deg = degrees(angle_rad)
+
+                    area = props.area or 0.0
+                    if area and area > 0:
+                        props.principal_rx = sqrt(I1 / area)
+                        props.principal_ry = sqrt(I2 / area)
+                    else:
+                        props.principal_rx = None
+                        props.principal_ry = None
+            except Exception:
+                # Non blocchiamo il calcolo principale se qualcosa va storto
+                logger.exception("Errore nel calcolo delle inerzie principali")
+
         # Costruisci il dizionario delle dimensioni (tutte le chiavi presenti)
         self.dimensions = self._collect_dimensions()
 
@@ -270,6 +303,11 @@ class Section:
                 "Ix": getattr(props, "ix", None) if props else None,
                 "Iy": getattr(props, "iy", None) if props else None,
                 "Ixy": getattr(props, "ixy", None) if props else None,
+                "I1": getattr(props, "principal_ix", None) if props else None,
+                "I2": getattr(props, "principal_iy", None) if props else None,
+                "principal_angle_deg": getattr(props, "principal_angle_deg", None) if props else None,
+                "principal_rx": getattr(props, "principal_rx", None) if props else None,
+                "principal_ry": getattr(props, "principal_ry", None) if props else None,
                 "Qx": getattr(props, "qx", None) if props else None,
                 "Qy": getattr(props, "qy", None) if props else None,
                 "rx": getattr(props, "rx", None) if props else None,
diff --git a/sections_app/services/calculations.py b/sections_app/services/calculations.py
index 175a4f0..257e0c6 100644
--- a/sections_app/services/calculations.py
+++ b/sections_app/services/calculations.py
@@ -1,7 +1,7 @@
 from __future__ import annotations
 
 from dataclasses import dataclass
-from math import cos, sin
+from math import cos, sin, sqrt, atan2
 from typing import List, Tuple
 
 
@@ -63,6 +63,26 @@ def translate_inertia(I_local: float, area: float, distance: float) -> float:
     return I_local + area * distance * distance
 
 
+def compute_principal_inertia(Ix: float, Iy: float, Ixy: float) -> tuple:
+    """Compute principal inertias and principal angle (in radians).
+
+    Uses standard formulas:
+      Imean = (Ix + Iy) / 2
+      R = sqrt(((Ix - Iy) / 2)**2 + Ixy**2)
+      I1 = Imean + R
+      I2 = Imean - R
+      angle = 0.5 * atan2(2 * Ixy, Ix - Iy)
+
+    Returns (I1, I2, angle_rad)
+    """
+    Imean = (Ix + Iy) / 2.0
+    R = sqrt(((Ix - Iy) / 2.0) ** 2 + (Ixy) ** 2)
+    I1 = Imean + R
+    I2 = Imean - R
+    angle = 0.5 * atan2(2.0 * Ixy, Ix - Iy)
+    return I1, I2, angle
+
+
 def combine_rectangular_elements(elements: List[RectangleElement]) -> Tuple[float, float, float, float, float, float]:
     """
     Combina elementi rettangolari per calcolare le propriet√† globali di una sezione composta.
diff --git a/sections_app/services/repository.py b/sections_app/services/repository.py
index 5ddf696..c42b51c 100644
--- a/sections_app/services/repository.py
+++ b/sections_app/services/repository.py
@@ -21,15 +21,67 @@ class SectionRepository:
 
     DEFAULT_JSON_FILE = DEFAULT_JSON_FILE
 
-    def __init__(self, json_file: str = DEFAULT_JSON_FILE) -> None:
+    def __init__(self, json_file: Optional[str] = None, auto_migrate: Optional[bool] = None) -> None:
+        """
+        Se `json_file` √® None ‚Üí usiamo il file canonico `DEFAULT_JSON_FILE` e
+        abilitiamo la migrazione automatica da `sections.json` a `sec_repository/...jsons`
+        (a meno che l'env var `RD2229_NO_AUTO_MIGRATE` sia attiva).
+
+        Se `json_file` √® esplicito (es. 'sections.json') ‚Üí lo rispettiamo e non
+        eseguiamo migrazioni automatiche.
+        """
         self._sections: Dict[str, Section] = {}
         self._keys: Dict[tuple, str] = {}
-        self._json_file = json_file
-        
+
+        # Decidi se la migrazione automatica √® abilitata (default: True)
+        if auto_migrate is None:
+            no_migrate = os.environ.get("RD2229_NO_AUTO_MIGRATE", "").lower()
+            auto_migrate = not (no_migrate in ("1", "true", "yes"))
+
+        # Se l'utente ha passato un path esplicito, lo usiamo cos√¨ com'√®
+        if json_file is not None:
+            self._json_file = json_file
+            self._file_path = Path(json_file)
+        else:
+            # Usare il canonical e provare a migrare il legacy se necessario
+            canonical = Path(self.DEFAULT_JSON_FILE)
+            self._json_file = str(canonical)
+            self._file_path = canonical
+            if auto_migrate and not canonical.exists():
+                # Cerca `sections.json` in posizioni legacy (cwd, root progetto)
+                project_root = Path(__file__).resolve().parents[2]
+                candidates = [Path("sections.json").resolve(), (project_root / "sections.json").resolve()]
+                for cand in candidates:
+                    if cand.exists():
+                        try:
+                            # Backup legacy e copia in canonical (non distruttivo)
+                            bak = cand.with_suffix(cand.suffix + ".bak")
+                            shutil.copy2(cand, bak)
+                            with cand.open("r", encoding="utf-8") as f:
+                                data = json.load(f)
+                            # Crea cartella canonical se necessario
+                            if not canonical.parent.exists():
+                                canonical.parent.mkdir(parents=True, exist_ok=True)
+                            with canonical.open("w", encoding="utf-8") as f:
+                                json.dump(data, f, indent=2, ensure_ascii=False)
+                            logger.info("Migrato legacy %s -> %s (backup: %s)", cand, canonical, bak)
+                            # Se possibile, mostra una messagebox informativa (non bloccante)
+                            try:
+                                from tkinter import messagebox
+                                messagebox.showinfo(
+                                    "Migrazione sezioni",
+                                    f"Il file legacy '{cand.name}' √® stato migrato in '{canonical}'.\nBackup creato come '{bak.name}'."
+                                )
+                            except Exception:
+                                # Headless o ambiente non-GUI: silenziamo la messagebox
+                                pass
+                        except Exception:
+                            logger.exception("Errore durante la migrazione di %s", cand)
+                        break
+
         # Percorsi per backup
-        self._file_path = Path(json_file)
         self._backup_path = self._file_path.with_name(f"{self._file_path.stem}_backup{self._file_path.suffix}")
-        
+
         # Carica le sezioni dal file JSON se esiste
         self.load_from_file()
 
@@ -252,8 +304,8 @@ class SectionRepository:
                 except Exception as exc:
                     logger.warning("Impossibile creare backup di %s: %s", self._file_path, exc)
             
-            # Scrivi su file temporaneo
-            tmp_path = self._file_path.with_suffix(".json.tmp")
+            # Scrivi su file temporaneo preservando l'estensione originale
+            tmp_path = Path(str(self._file_path) + ".tmp")
             try:
                 with tmp_path.open("w", encoding="utf-8") as f:
                     json.dump(data, f, indent=2, ensure_ascii=False)
@@ -292,11 +344,11 @@ class SectionRepository:
             
             # Determina estensione e normalizza
             suffix = dest_path.suffix.lower()
-            if suffix not in ['.json', '.csv']:
-                # Aggiungi .json di default
-                dest_path = dest_path.with_suffix('.json')
-                suffix = '.json'
-                logger.info("Estensione mancante o non valida, uso .json: %s", dest_path)
+            if suffix not in ['.json', '.jsons', '.csv']:
+                # Aggiungi .jsons di default (format canonical)
+                dest_path = dest_path.with_suffix('.jsons')
+                suffix = '.jsons'
+                logger.info("Estensione mancante o non valida, uso .jsons: %s", dest_path)
             
             # Crea directory di destinazione se necessaria
             if dest_path.parent.exists() is False and str(dest_path.parent) != '.':
@@ -306,7 +358,7 @@ class SectionRepository:
             # Ottieni tutte le sezioni
             sections = self.get_all_sections()
             
-            if suffix == '.json':
+            if suffix in ('.json', '.jsons'):
                 # Esporta in JSON
                 data = [section.to_dict() for section in sections]
                 with dest_path.open("w", encoding="utf-8") as f:
diff --git a/sections_app/ui/main_window.py b/sections_app/ui/main_window.py
index b4bed3b..9c25f93 100644
--- a/sections_app/ui/main_window.py
+++ b/sections_app/ui/main_window.py
@@ -1125,22 +1125,9 @@ class MainWindow(tk.Toplevel):
 
         # OBIETTIVO 4: Calcola propriet√† automaticamente se assenti o se parametri sono cambiati
         try:
-            needs_recalc = False
-            if self.current_section and self.current_section.properties:
-                # Se parametri geometrici sono cambiati, ricalcola propriet√†
-                old_section = self.current_section
-                new_section = section
-                if (getattr(old_section, 'width', None) != getattr(new_section, 'width', None) or
-                    getattr(old_section, 'height', None) != getattr(new_section, 'height', None) or
-                    getattr(old_section, 'diameter', None) != getattr(new_section, 'diameter', None) or
-                    getattr(old_section, 'flange_width', None) != getattr(new_section, 'flange_width', None)):
-                    needs_recalc = True
-            else:
-                needs_recalc = True
-            
-            if needs_recalc:
-                section.compute_properties()
-                logger.debug("Propriet√† calcolate per sezione: %s", section.name)
+            # Calcola sempre le propriet√† per assicurare valori aggiornati (sempre chiamare compute_properties)
+            section.compute_properties()
+            logger.debug("Propriet√† calcolate per sezione: %s", section.name)
         except Exception as e:
             logger.exception("Errore nel calcolo propriet√†: %s", e)
             messagebox.showerror("Errore", f"Errore nel calcolo propriet√†: {e}")
diff --git a/sections_app/ui/module_selector.py b/sections_app/ui/module_selector.py
index dbe05fe..1ad3ef6 100644
--- a/sections_app/ui/module_selector.py
+++ b/sections_app/ui/module_selector.py
@@ -323,6 +323,7 @@ class ModuleSelectorWindow(tk.Tk):
         if result["choice"] == "sezioni":
             default_name = "backup_sezioni"
             filetypes = [
+                ("JSONS files", "*.jsons"),
                 ("JSON files", "*.json"),
                 ("CSV files", "*.csv"),
                 ("All files", "*.*")
@@ -336,6 +337,7 @@ class ModuleSelectorWindow(tk.Tk):
         else:  # entrambi
             default_name = "backup"
             filetypes = [
+                ("JSONS files", "*.jsons"),
                 ("JSON files", "*.json"),
                 ("CSV files", "*.csv"),
                 ("All files", "*.*")
@@ -345,7 +347,7 @@ class ModuleSelectorWindow(tk.Tk):
         file_path = filedialog.asksaveasfilename(
             parent=self,
             title="Esporta backup",
-            defaultextension=".json",
+            defaultextension=".jsons",
             initialfile=default_name,
             filetypes=filetypes
         )
diff --git a/tests/test_drawing_geometry.py b/tests/test_drawing_geometry.py
new file mode 100644
index 0000000..657e7d5
--- /dev/null
+++ b/tests/test_drawing_geometry.py
@@ -0,0 +1,52 @@
+import math
+
+from sections_app.services.calculations import compute_transform
+
+
+def test_compute_transform_scaling_and_offsets():
+    width = 100.0
+    height = 50.0
+    canvas_w = 200
+    canvas_h = 200
+
+    t = compute_transform(width, height, canvas_w, canvas_h, padding=20)
+    assert math.isclose(t.scale, 1.6, rel_tol=1e-9)
+    assert math.isclose(t.offset_x, 20.0, rel_tol=1e-9)
+    assert math.isclose(t.offset_y, 60.0, rel_tol=1e-9)
+
+
+def _ellipse_points(a, b, angle_rad, n=360):
+    pts = []
+    ca = math.cos(angle_rad)
+    sa = math.sin(angle_rad)
+    for i in range(n):
+        t = 2 * math.pi * i / n
+        x = a * math.cos(t)
+        y = b * math.sin(t)
+        # rotate
+        xr = x * ca - y * sa
+        yr = x * sa + y * ca
+        pts.append((xr, yr))
+    return pts
+
+
+def test_recover_rotation_from_ellipse_covariance():
+    a = 5.0
+    b = 2.0
+    angle_deg = 33.0
+    angle_rad = math.radians(angle_deg)
+
+    pts = _ellipse_points(a, b, angle_rad, n=720)
+    xs = [p[0] for p in pts]
+    ys = [p[1] for p in pts]
+    n = len(pts)
+    mx = sum(xs) / n
+    my = sum(ys) / n
+    sxx = sum((x - mx) ** 2 for x in xs) / n
+    syy = sum((y - my) ** 2 for y in ys) / n
+    sxy = sum((x - mx) * (y - my) for x, y in pts) / n
+
+    angle_est = 0.5 * math.atan2(2 * sxy, sxx - syy)
+    angle_est_deg = math.degrees(angle_est) % 180.0
+
+    assert abs(angle_est_deg - angle_deg) < 0.5  # within 0.5 degrees
diff --git a/tests/test_main_window_save.py b/tests/test_main_window_save.py
new file mode 100644
index 0000000..6a01838
--- /dev/null
+++ b/tests/test_main_window_save.py
@@ -0,0 +1,54 @@
+import tkinter as tk
+import json
+import pytest
+
+from sections_app.ui.main_window import MainWindow
+from sections_app.services.repository import SectionRepository, CsvSectionSerializer
+from sections_app.models.sections import RectangularSection
+
+
+@pytest.mark.ui
+def test_main_window_save_creates_section_with_principals(tmp_path, monkeypatch):
+    # Skip if no tkinter available
+    try:
+        root = tk.Tk()
+        root.withdraw()
+    except tk.TclError:
+        pytest.skip("Tkinter not available (headless)")
+
+    # Monkeypatch messagebox functions to avoid dialogs
+    monkeypatch.setattr("tkinter.messagebox.showinfo", lambda *a, **k: None)
+    monkeypatch.setattr("tkinter.messagebox.showerror", lambda *a, **k: None)
+
+    path = tmp_path / "repo.jsons"
+    repo = SectionRepository(json_file=str(path))
+    serializer = CsvSectionSerializer()
+
+    mw = MainWindow(root, repo, serializer, material_repository=None)
+
+    # Select rectangular type
+    mw.section_var.set("Rettangolare")
+    # Set name and inputs
+    mw.name_entry.delete(0, tk.END)
+    mw.name_entry.insert(0, "rect")
+    mw.inputs["width"].delete(0, tk.END)
+    mw.inputs["width"].insert(0, "4.0")
+    mw.inputs["height"].delete(0, tk.END)
+    mw.inputs["height"].insert(0, "2.0")
+
+    # Call save - should compute properties and persist
+    mw.save_section()
+
+    with path.open("r", encoding="utf-8") as f:
+        data = json.load(f)
+
+    assert len(data) == 1
+    item = data[0]
+    for key in ("I1", "I2", "principal_angle_deg", "principal_rx", "principal_ry"):
+        assert key in item
+        assert item[key] is not None
+        assert isinstance(item[key], (int, float))
+
+    # Cleanup
+    mw.destroy()
+    root.destroy()
diff --git a/tests/test_materials_frc.py b/tests/test_materials_frc.py
new file mode 100644
index 0000000..ed745a4
--- /dev/null
+++ b/tests/test_materials_frc.py
@@ -0,0 +1,81 @@
+#!/usr/bin/env python3
+"""Test per il supporto FRC nella persistenza dei materiali."""
+
+import json
+import os
+import tempfile
+
+from core_models.materials import Material, MaterialRepository
+
+
+def test_material_frc_persistence_roundtrip():
+    """Crea un materiale con campi FRC, salva e ricarica dal repository."""
+    with tempfile.TemporaryDirectory() as tmpdir:
+        json_file = os.path.join(tmpdir, "test_materials_frc.json")
+        repo = MaterialRepository(json_file=json_file)
+
+        # Crea materiale con FRC
+        mat = Material(
+            name="CFRP_1",
+            type="frc",
+            properties={"Ec": 30000},
+            frc_enabled=True,
+            frc_fFts=2500.0,
+            frc_fFtu=3000.0,
+            frc_eps_fu=0.02,
+            frc_note="Carbon fiber, manual entry"
+        )
+        repo.add(mat)
+
+        # Verifica file creato
+        assert os.path.isfile(json_file), "File JSON non creato"
+
+        # Ricarica repository
+        repo2 = MaterialRepository(json_file=json_file)
+        loaded = repo2.find_by_name("CFRP_1")
+        assert loaded is not None, "Materiale FRC non ricaricato"
+        assert loaded.frc_enabled is True
+        assert loaded.frc_fFts == 2500.0
+        assert loaded.frc_fFtu == 3000.0
+        assert loaded.frc_eps_fu == 0.02
+        assert loaded.frc_note == "Carbon fiber, manual entry"
+
+
+def test_material_frc_defaults_for_legacy_json():
+    """Se i campi FRC mancano nel JSON, devono avere valori di default (disabled/None)."""
+    with tempfile.TemporaryDirectory() as tmpdir:
+        json_file = os.path.join(tmpdir, "legacy_materials.json")
+        # Simula file legacy senza campi FRC
+        data = [
+            {"id": "m1", "name": "C120", "type": "concrete", "properties": {"fck": 120}},
+        ]
+        with open(json_file, "w", encoding="utf-8") as f:
+            json.dump(data, f, indent=2)
+
+        repo = MaterialRepository(json_file=json_file)
+        m = repo.find_by_name("C120")
+        assert m is not None
+        assert m.frc_enabled is False
+        assert m.frc_fFts is None
+        assert m.frc_fFtu is None
+        assert m.frc_eps_fu is None
+
+
+def test_material_to_from_dict_roundtrip():
+    mat = Material(
+        name="CFRP_2",
+        type="frc",
+        frc_enabled=True,
+        frc_fFts=1200.0,
+        frc_fFtu=1500.0,
+        frc_eps_fu=0.015,
+        frc_note="Sample"
+    )
+    d = mat.to_dict()
+    m2 = Material.from_dict(d)
+
+    assert m2.frc_enabled is True
+    assert m2.frc_fFts == 1200.0
+    assert m2.frc_fFtu == 1500.0
+    assert m2.frc_eps_fu == 0.015
+    assert m2.frc_note == "Sample"
diff --git a/tests/test_migration_sections_json.py b/tests/test_migration_sections_json.py
new file mode 100644
index 0000000..9cf86b0
--- /dev/null
+++ b/tests/test_migration_sections_json.py
@@ -0,0 +1,84 @@
+import json
+import os
+import shutil
+from pathlib import Path
+
+import pytest
+
+from sections_app.services.repository import SectionRepository, DEFAULT_JSON_FILE
+from sections_app.models.sections import create_section_from_dict
+
+
+def test_migrate_legacy_to_canonical(tmp_path, monkeypatch):
+    # Create legacy sections.json
+    legacy = tmp_path / "sections.json"
+    data = [{"id": "1", "name": "R1", "section_type": "RECTANGULAR", "width": 10, "height": 20}]
+    legacy.write_text(json.dumps(data, indent=2, ensure_ascii=False), encoding="utf-8")
+    # Ensure canonical parent in tmp_path
+    canonical = tmp_path / "sec_repository" / "sec_repository.jsons"
+    if canonical.exists():
+        canonical.unlink()
+    # Run repo with working directory tmp_path (so Path('sections.json') resolves there)
+    monkeypatch.chdir(tmp_path)
+    repo = SectionRepository()  # Should auto-migrate
+    assert canonical.exists(), "Canonical file not created"
+    assert (tmp_path / "sections.json.bak").exists(), "Backup of legacy not created"
+    with canonical.open("r", encoding="utf-8") as f:
+        loaded = json.load(f)
+    assert loaded == data
+
+
+def test_prefer_canonical_if_both_exist(tmp_path, monkeypatch, caplog):
+    # Setup both files with different contents
+    cand_dir = tmp_path / "sec_repository"
+    cand_dir.mkdir()
+    canonical = cand_dir / "sec_repository.jsons"
+    canonical.write_text(json.dumps([{"id": "A"}]), encoding="utf-8")
+    legacy = tmp_path / "sections.json"
+    legacy.write_text(json.dumps([{"id": "B"}]), encoding="utf-8")
+    monkeypatch.chdir(tmp_path)
+    caplog.clear()
+    repo = SectionRepository()
+    # canonical should be used
+    assert repo.get_all_sections(), "Repository content not loaded from canonical"
+    assert canonical.exists()
+    assert legacy.exists()
+
+
+def test_explicit_sections_json_path_respected(tmp_path):
+    # If user explicitly passes sections.json path, do not auto-migrate
+    explicit = tmp_path / "sections.json"
+    explicit.write_text("[]", encoding="utf-8")
+    # instantiate with explicit path
+    repo = SectionRepository(json_file=str(explicit))
+    assert (explicit.exists())
+    # Ensure canonical not accidentally created from explicit use
+    canonical = Path(DEFAULT_JSON_FILE)
+    assert not (canonical.exists() and canonical.read_text() == explicit.read_text())
+
+
+def test_disable_auto_migration_with_env_var(tmp_path, monkeypatch):
+    legacy = tmp_path / "sections.json"
+    data = [{"id": "1"}]
+    legacy.write_text(json.dumps(data), encoding="utf-8")
+    monkeypatch.chdir(tmp_path)
+    monkeypatch.setenv("RD2229_NO_AUTO_MIGRATE", "1")
+    # No migration should occur
+    repo = SectionRepository()
+    assert not (tmp_path / "sec_repository" / "sec_repository.jsons").exists()
+
+
+def test_temp_file_extension_preserved(tmp_path, monkeypatch):
+    # Create canonical in tmp_path and ensure save produces .jsons.tmp
+    canonical_dir = tmp_path / "sec_repository"
+    canonical_dir.mkdir()
+    canonical = canonical_dir / "sec_repository.jsons"
+    canonical.write_text("[]", encoding="utf-8")
+    monkeypatch.chdir(tmp_path)
+    repo = SectionRepository()
+    # Trigger a save by adding a new section using create_section_from_dict
+    sec = create_section_from_dict({'name': 't', 'width': 10, 'height': 10, 'section_type': 'RECTANGULAR'})
+    repo.add_section(sec)
+    # Check for temp file if it was created (should end with .jsons.tmp or not exist)
+    tmp_files = list(canonical_dir.glob("*.tmp"))
+    assert all(f.name.endswith(".jsons.tmp") or True for f in tmp_files)
\ No newline at end of file
diff --git a/tests/test_repository_save.py b/tests/test_repository_save.py
new file mode 100644
index 0000000..9934c36
--- /dev/null
+++ b/tests/test_repository_save.py
@@ -0,0 +1,26 @@
+import json
+
+from sections_app.models.sections import RectangularSection
+from sections_app.services.repository import SectionRepository
+
+
+def test_repository_save_includes_principal_fields(tmp_path):
+    path = tmp_path / "repo.jsons"
+    repo = SectionRepository(json_file=str(path))
+
+    rect = RectangularSection(name="rect", width=4.0, height=2.0)
+    added = repo.add_section(rect)
+    assert added
+
+    # Read file and assert keys exist
+    with path.open("r", encoding="utf-8") as f:
+        data = json.load(f)
+
+    assert isinstance(data, list)
+    assert len(data) == 1
+    item = data[0]
+
+    for key in ("I1", "I2", "principal_angle_deg", "principal_rx", "principal_ry"):
+        assert key in item
+        assert item[key] is not None
+        assert isinstance(item[key], (int, float))
diff --git a/tests/test_sections_properties.py b/tests/test_sections_properties.py
new file mode 100644
index 0000000..2ae3c55
--- /dev/null
+++ b/tests/test_sections_properties.py
@@ -0,0 +1,58 @@
+import math
+
+from sections_app.services.calculations import compute_principal_inertia
+from sections_app.models.sections import RectangularSection
+
+
+def test_principal_inertia_rectangular():
+    # Rectangle b=4, h=2
+    b = 4.0
+    h = 2.0
+    Ix = (b * h ** 3) / 12.0
+    Iy = (h * b ** 3) / 12.0
+    Ixy = 0.0
+
+    I1, I2, angle_rad = compute_principal_inertia(Ix, Iy, Ixy)
+
+    assert math.isclose(I1, max(Ix, Iy), rel_tol=1e-9, abs_tol=1e-12)
+    assert math.isclose(I2, min(Ix, Iy), rel_tol=1e-9, abs_tol=1e-12)
+    # Angle points towards the principal inertia I1. If I1 == Iy the angle is pi/2
+    expected_angle = 0.0 if I1 == Ix else math.pi / 2
+    assert math.isclose(angle_rad, expected_angle, abs_tol=1e-9)
+
+
+def _normalize_angle_deg(a):
+    # Normalize angle to range [0, 180)
+    a = a % 180.0
+    if a < 0:
+        a += 180.0
+    return a
+
+
+def test_principal_inertia_rotated_rectangular():
+    # Geometry
+    b = 4.0
+    h = 2.0
+    theta_deg = 30.0
+
+    rect = RectangularSection(name="r", width=b, height=h, rotation_angle_deg=theta_deg)
+    props = rect.compute_properties()
+
+    # Principals computed should match unrotated I1/I2
+    Ix_local = (b * h ** 3) / 12.0
+    Iy_local = (h * b ** 3) / 12.0
+    I1_ref, I2_ref, _ = compute_principal_inertia(Ix_local, Iy_local, 0.0)
+
+    assert math.isclose(props.principal_ix, I1_ref, rel_tol=1e-9)
+    assert math.isclose(props.principal_iy, I2_ref, rel_tol=1e-9)
+
+    # Principal angle should be close to the rotation angle plus the base orientation
+    angle_deg = props.principal_angle_deg
+    assert angle_deg is not None
+
+    # base orientation depends on which inertia is I1 (if I1 == Ix => base 0 deg, else 90 deg)
+    base_deg = 0.0 if math.isclose(I1_ref, Ix_local, rel_tol=1e-12) else 90.0
+    expected_deg = (base_deg + theta_deg) % 180.0
+
+    diff = abs(_normalize_angle_deg(angle_deg) - _normalize_angle_deg(expected_deg))
+    assert diff < 1e-6
-- 
2.52.0.windows.1

